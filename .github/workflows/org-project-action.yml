name: Project Org Policies

on:
  push:
    branches:
    - main

env:
  PROJECT: ${{ secrets.GCE_PROJECT }}

jobs:
  setup:
    name: Setup
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v2
      
    - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
      with:
        version: '313.0.0'
        service_account_key: ${{ secrets.GCE_SA_KEY }}
        project_id: ${{ secrets.GCE_PROJECT }}
        project_key_id: ${{ secrets.GCE_SA_ID }}
     
    - name: Deploy
      run: |
      
      #List Types
		      gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/iam.allowServiceAccountCredentialLifetimeExtension All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/iam.workloadIdentityPoolProviders All
  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/cloudfunctions.allowedIngressSettings All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/cloudfunctions.allowedVpcConnectorEgressSettings All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.storageResourceUseRestrictions All
    
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet  constraints/iam.workloadIdentityPoolProviders All
   
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.trustedImageProjects All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/serviceuser.services All
		  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/storage.retentionPolicySeconds All
		  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictVpnPeerIPs All
		  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictVpcPeering All
        
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.vmCanIpForward All
		  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictSharedVpcSubnetworks All
       
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictSharedVpcHostProjects All
		
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictPartnerInterconnectUsage All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictProtocolForwardingCreationForTypes All
   
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictDirectGoogleAccess All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictLoadBalancerCreationForTypes All
  
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictCloudNATUsage All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictDedicatedInterconnectUsage All
          
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/compute.restrictAuthenticatedGoogleConnection All
          
          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/gcp.resourceLocations All

          gcloud resource-manager org-policies allow --project ${{env.project}} --quiet constraints/iam.allowedPolicyMemberDomains All
		
		
		  #Boolean Types
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/iam.automaticIamGrantsForDefaultServiceAccounts
      
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/gcp.disableCloudLogging

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.disableGuestAttributesAccess

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.disableInternetNetworkEndpointGroup  
		  
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/iam.disableServiceAccountCreation

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/iam.disableServiceAccountKeyCreation

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/iam.disableServiceAccountKeyUpload
    
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/appengine.disableCodeDownload

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.disableNestedVirtualization
   
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.disableSerialPortAccess
		  
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.disableSerialPortLogging

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/iam.disableWorkloadIdentityClusterCreation	  
	  
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/storage.uniformBucketLevelAccess

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/gcp.detailedAuditLoggingMode
         
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.requireOsLogin
  
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/cloudfunctions.requireVPCConnector
      
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/sql.restrictAuthorizedNetworks
          
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/sql.disableDefaultEncryptionCreation
        
		      gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/sql.restrictPublicIp
       
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.restrictXpnProjectLienRemoval
		  
          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.requireShieldedVm

          gcloud resource-manager org-policies disable-enforce --project ${{env.project}} --quiet constraints/compute.skipDefaultNetworkCreation
		  
		  
